# 教师智能助手系统 - 数据库表结构设计

## 项目概述
本文档详细描述了教师智能助手系统的数据库表结构设计，基于前后端分离架构（Vue.js + Flask），支持资料管理、考勤管理、成绩分析、课堂互动等核心功能，并集成智能特性。

---

## 1. 用户与权限模块

### 1.1 `users` - 用户表
用于存储系统所有用户的基本信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| username | VARCHAR(50) | NOT NULL | 用户名 |
| user_code | VARCHAR(50) | UNIQUE, NOT NULL | 工号/学号 |
| password_hash | VARCHAR(255) | NOT NULL | 密码哈希值 |
| email | VARCHAR(100) | UNIQUE, NOT NULL | 邮箱 |
| phone | VARCHAR(20) | NULL | 手机号 |
| real_name | VARCHAR(50) | NOT NULL | 真实姓名 |
| avatar | VARCHAR(255) | NULL | 头像URL |
| role | VARCHAR(20) | NOT NULL default 'student'  | 角色(admin/teacher/student) |
| class_id | INT | NULL | 班级ID(学生角色时使用) **[FK→classes.id]** |
| status | TINYINT | DEFAULT 1 | 账号状态(1:正常, 0:禁用) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| last_login_time | DATETIME | NULL | 最后登录时间 |

**索引:**
- `idx_username` ON (username)
- `idx_user_code` ON (user_code)
- `idx_email` ON (email)
- `idx_role` ON (role)
- `idx_class_id` ON (class_id)

**角色说明:**
- `admin`: 系统管理员
- `teacher`: 教师
- `student`: 学生

---

## 2. 资料中心模块

### 2.1 `materials` - 资料表
存储所有教学资料的元数据和文件信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 资料ID |
| title | VARCHAR(200) | NOT NULL | 资料标题 |
| description | TEXT | NULL | 资料描述 |
| file_name | VARCHAR(255) | NOT NULL | 原始文件名 |
| file_path | VARCHAR(500) | NOT NULL | 文件存储路径 |
| file_size | BIGINT | NOT NULL | 文件大小(字节) |
| file_type | VARCHAR(50) | NOT NULL | 文件类型(pdf/doc/ppt/xlsx等) |
| course_id | INT | NULL | 关联课程ID **[FK→courses.id]** |
| uploader_id | INT | NOT NULL | 上传者ID **[FK→users.id]** |
| category_id | INT | NULL | 分类ID **[FK→material_categories.id]** |
| download_count | INT | DEFAULT 0 | 下载次数 |
| view_count | INT | DEFAULT 0 | 浏览次数 |
| keywords | TEXT | NULL | 关键词(逗号分隔,用于智能归类) |
| auto_classified | TINYINT | DEFAULT 0 | 是否自动分类(1:是, 0:否) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 上传时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- `idx_uploader_id` ON (uploader_id)
- `idx_category_id` ON (category_id)
- `idx_create_time` ON (create_time)
- FULLTEXT `idx_title_desc` ON (title, description) -- 全文搜索

---

### 2.2 `material_categories` - 资料分类表
支持多级分类的资料分类体系。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 分类ID |
| name | VARCHAR(100) | NOT NULL | 分类名称 |
| parent_id | INT | NULL | 父分类ID(NULL表示顶级分类) **[FK→material_categories.id]** |
| description | VARCHAR(255) | NULL | 分类描述 |
| sort_order | INT | DEFAULT 0 | 排序序号 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_parent_id` ON (parent_id)

---

### 2.3 `material_tags` - 资料标签表
用于资料的标签管理。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 标签ID |
| name | VARCHAR(50) | UNIQUE, NOT NULL | 标签名称 |
| usage_count | INT | DEFAULT 0 | 使用次数 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

---

### 2.4 `material_tag_relation` - 资料标签关联表
多对多关系：资料与标签的关联。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 关联ID |
| material_id | INT | NOT NULL | 资料ID **[FK→materials.id]** |
| tag_id | INT | NOT NULL | 标签ID **[FK→material_tags.id]** |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_material_id` ON (material_id)
- `idx_tag_id` ON (tag_id)
- UNIQUE `uk_material_tag` ON (material_id, tag_id)

---

## 3. 课程模块

### 3.1 `classes` - 班级表
存储班级基本信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 班级ID |
| name | VARCHAR(100) | NOT NULL | 班级名称(如:计算机2024-1班) |
| code | VARCHAR(50) | UNIQUE, NOT NULL | 班级代码 |
| grade | VARCHAR(20) | NOT NULL | 年级(如:2024级) |
| major | VARCHAR(100) | NOT NULL | 专业 |
| department | VARCHAR(100) | NULL | 院系 |
| class_teacher_id | INT | NULL | 班主任ID(关联users表) **[FK→users.id]** |
| student_count | INT | DEFAULT 0 | 学生人数 |
| enrollment_year | INT | NOT NULL | 入学年份(如:2024) |
| status | TINYINT | DEFAULT 1 | 状态(1:在读, 0:已毕业) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_code` ON (code)
- `idx_grade` ON (grade)
- `idx_major` ON (major)
- `idx_class_teacher_id` ON (class_teacher_id)
- `idx_enrollment_year` ON (enrollment_year)

---

### 3.2 `courses` - 课程表
存储课程基本信息。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 课程ID |
| name | VARCHAR(100) | NOT NULL | 课程名称 |
| code | VARCHAR(50) | UNIQUE, NOT NULL | 课程代码 |
| description | TEXT | NULL | 课程描述 |
| teacher_id | INT | NOT NULL | 授课教师ID **[FK→users.id]** |
| semester | VARCHAR(20) | NOT NULL | 学期(如:2024-2025-1) |
| academic_year | VARCHAR(20) | NOT NULL | 学年(如:2024-2025) |
| credit | DECIMAL(3,1) | NULL | 学分 |
| total_hours | INT | NULL | 总学时 |
| status | TINYINT | DEFAULT 1 | 课程状态(1:进行中, 0:已结束) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_teacher_id` ON (teacher_id)
- `idx_code` ON (code)
- `idx_semester` ON (semester)

---

### 3.3 `course_classes` - 课程班级关联表
多对多关系:课程与班级的关联(一门课程可以有多个班级上,一个班级可以上多门课程)。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 关联ID |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| class_id | INT | NOT NULL | 班级ID **[FK→classes.id]** |
| start_date | DATE | NULL | 开课日期 |
| end_date | DATE | NULL | 结课日期 |
| status | TINYINT | DEFAULT 1 | 状态(1:进行中, 0:已结束) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- `idx_class_id` ON (class_id)
- UNIQUE `uk_course_class` ON (course_id, class_id)

---

## 4. 考勤管理模块

### 4.1 `attendances` - 考勤任务表
教师创建的考勤任务。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 考勤任务ID |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| class_id | INT | NULL | 班级ID(可选,用于指定班级考勤) **[FK→classes.id]** |
| teacher_id | INT | NOT NULL | 教师ID **[FK→users.id]** |
| title | VARCHAR(100) | NOT NULL | 考勤标题 |
| attendance_type | VARCHAR(20) | NOT NULL | 考勤方式(qrcode/manual/face) |
| qr_code | VARCHAR(255) | NULL | 二维码token |
| start_time | DATETIME | NOT NULL | 开始时间 |
| end_time | DATETIME | NOT NULL | 结束时间 |
| location | VARCHAR(100) | NULL | 考勤地点 |
| require_location | TINYINT | DEFAULT 0 | 是否需要位置验证 |
| status | VARCHAR(20) | DEFAULT 'pending' | 状态(pending/active/ended) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- `idx_class_id` ON (class_id)
- `idx_teacher_id` ON (teacher_id)
- `idx_start_time` ON (start_time)
- `idx_qr_code` ON (qr_code)

---

### 4.2 `attendance_records` - 考勤记录表
学生的具体签到记录。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 记录ID |
| attendance_id | INT | NOT NULL | 考勤任务ID **[FK→attendances.id]** |
| student_id | INT | NOT NULL | 学生ID **[FK→users.id]** |
| status | VARCHAR(20) | NOT NULL | 出勤状态(present/late/absent/leave) |
| check_in_time | DATETIME | NULL | 签到时间 |
| check_in_method | VARCHAR(20) | NULL | 签到方式(qrcode/manual/face/location) |
| latitude | DECIMAL(10,7) | NULL | 签到纬度 |
| longitude | DECIMAL(10,7) | NULL | 签到经度 |
| face_image_path | VARCHAR(255) | NULL | 人脸识别照片路径 |
| remark | VARCHAR(255) | NULL | 备注 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_attendance_id` ON (attendance_id)
- `idx_student_id` ON (student_id)
- UNIQUE `uk_attendance_student` ON (attendance_id, student_id)

---

### 4.3 `attendance_statistics` - 考勤统计表
按课程统计学生的考勤情况。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 统计ID |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| student_id | INT | NOT NULL | 学生ID **[FK→users.id]** |
| total_count | INT | DEFAULT 0 | 总考勤次数 |
| present_count | INT | DEFAULT 0 | 出勤次数 |
| late_count | INT | DEFAULT 0 | 迟到次数 |
| absent_count | INT | DEFAULT 0 | 缺勤次数 |
| leave_count | INT | DEFAULT 0 | 请假次数 |
| attendance_rate | DECIMAL(5,2) | DEFAULT 0.00 | 出勤率(%) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- `idx_student_id` ON (student_id)
- UNIQUE `uk_course_student_stat` ON (course_id, student_id)

---

## 5. 成绩管理模块

### 5.1 `grades` - 成绩表
存储学生的各类成绩记录。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 成绩ID |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| student_id | INT | NOT NULL | 学生ID **[FK→users.id]** |
| exam_type | VARCHAR(20) | NOT NULL | 考试类型(daily/midterm/final/homework) |
| exam_name | VARCHAR(100) | NULL | 考试名称 |
| score | DECIMAL(5,2) | NOT NULL | 分数 |
| full_score | DECIMAL(5,2) | DEFAULT 100.00 | 满分 |
| weight | DECIMAL(4,2) | DEFAULT 1.00 | 权重(用于计算总评) |
| exam_date | DATE | NULL | 考试日期 |
| remark | VARCHAR(255) | NULL | 备注 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 录入时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- `idx_student_id` ON (student_id)
- `idx_exam_type` ON (exam_type)

---

### 5.2 `grade_statistics` - 成绩统计表
按课程和考试类型统计成绩分布。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 统计ID |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| exam_type | VARCHAR(20) | NOT NULL | 考试类型 |
| exam_name | VARCHAR(100) | NULL | 考试名称 |
| total_students | INT | DEFAULT 0 | 总人数 |
| average_score | DECIMAL(5,2) | DEFAULT 0.00 | 平均分 |
| highest_score | DECIMAL(5,2) | DEFAULT 0.00 | 最高分 |
| lowest_score | DECIMAL(5,2) | DEFAULT 0.00 | 最低分 |
| std_deviation | DECIMAL(5,2) | DEFAULT 0.00 | 标准差 |
| median_score | DECIMAL(5,2) | DEFAULT 0.00 | 中位数 |
| pass_rate | DECIMAL(5,2) | DEFAULT 0.00 | 及格率(%) |
| excellent_rate | DECIMAL(5,2) | DEFAULT 0.00 | 优秀率(%) |
| score_distribution | JSON/TEXT | NULL | 分数段分布(JSON格式) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- UNIQUE `uk_course_exam` ON (course_id, exam_type, exam_name)

---

### 5.3 `grade_predictions` - 成绩预测表（智能模块）
基于机器学习的成绩预测和预警。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 预测ID |
| student_id | INT | NOT NULL | 学生ID **[FK→users.id]** |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| predicted_score | DECIMAL(5,2) | NOT NULL | 预测分数 |
| confidence | DECIMAL(5,4) | NULL | 置信度(0-1) |
| risk_level | VARCHAR(20) | NOT NULL | 风险等级(low/medium/high) |
| is_warning | TINYINT | DEFAULT 0 | 是否预警(1:是, 0:否) |
| prediction_date | DATE | NOT NULL | 预测日期 |
| model_version | VARCHAR(50) | NULL | 模型版本 |
| features_used | JSON/TEXT | NULL | 使用的特征(JSON格式) |
| recommendation | TEXT | NULL | 改进建议 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_student_id` ON (student_id)
- `idx_course_id` ON (course_id)
- `idx_is_warning` ON (is_warning)
- `idx_prediction_date` ON (prediction_date)

---

## 6. 课堂互动模块

### 6.1 `polls` - 投票表
课堂投票/问卷调查。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT | PRIMARY KEY, AUTO_INCREMENT | 投票ID |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| teacher_id | INT | NOT NULL | 教师ID **[FK→users.id]** |
| title | VARCHAR(200) | NOT NULL | 投票标题 |
| description | TEXT | NULL | 投票描述 |
| poll_type | VARCHAR(20) | NOT NULL | 投票类型(single/multiple) |
| options | JSON/TEXT | NOT NULL | 选项(JSON数组) |
| is_anonymous | TINYINT | DEFAULT 0 | 是否匿名(1:是, 0:否) |
| start_time | DATETIME | NOT NULL | 开始时间 |
| end_time | DATETIME | NOT NULL | 结束时间 |
| status | VARCHAR(20) | DEFAULT 'active' | 状态(active/ended) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- `idx_teacher_id` ON (teacher_id)

---

### 6.2 `poll_responses` - 投票响应表
学生的投票记录。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 响应ID |
| poll_id | INT | NOT NULL | 投票ID **[FK→polls.id]** |
| student_id | INT | NOT NULL | 学生ID **[FK→users.id]** |
| selected_options | JSON/TEXT | NOT NULL | 选中的选项(JSON数组) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 投票时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_poll_id` ON (poll_id)
- `idx_student_id` ON (student_id)
- UNIQUE `uk_poll_student` ON (poll_id, student_id)

---

### 6.3 `questions` - 提问表
课堂提问功能。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 问题ID |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| user_id | INT | NOT NULL | 提问者ID **[FK→users.id]** |
| content | TEXT | NOT NULL | 问题内容 |
| is_anonymous | TINYINT | DEFAULT 0 | 是否匿名(1:是, 0:否) |
| status | VARCHAR(20) | DEFAULT 'pending' | 状态(pending/answered) |
| like_count | INT | DEFAULT 0 | 点赞数 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- `idx_user_id` ON (user_id)
- `idx_status` ON (status)

---

### 6.4 `question_answers` - 回答表
问题的回答记录。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 回答ID |
| question_id | INT | NOT NULL | 问题ID **[FK→questions.id]** |
| user_id | INT | NOT NULL | 回答者ID **[FK→users.id]** |
| content | TEXT | NOT NULL | 回答内容 |
| is_accepted | TINYINT | DEFAULT 0 | 是否被采纳(1:是, 0:否) |
| like_count | INT | DEFAULT 0 | 点赞数 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_question_id` ON (question_id)
- `idx_user_id` ON (user_id)

---

### 6.5 `barrages` - 弹幕表
课堂弹幕功能。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 弹幕ID |
| course_id | INT | NOT NULL | 课程ID **[FK→courses.id]** |
| user_id | INT | NOT NULL | 用户ID **[FK→users.id]** |
| content | VARCHAR(200) | NOT NULL | 弹幕内容 |
| is_anonymous | TINYINT | DEFAULT 0 | 是否匿名(1:是, 0:否) |
| status | TINYINT | DEFAULT 1 | 状态(1:正常, 0:已删除) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_course_id` ON (course_id)
- `idx_user_id` ON (user_id)
- `idx_create_time` ON (create_time)

---

## 7. 智能模块相关

### 7.1 `document_keywords` - 文档关键词表（智能归类）
NLP提取的文档关键词，用于自动分类。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 关键词ID |
| material_id | INT | NOT NULL | 资料ID **[FK→materials.id]** |
| keyword | VARCHAR(100) | NOT NULL | 关键词 |
| weight | DECIMAL(5,4) | DEFAULT 0.0000 | 权重/重要性(0-1) |
| extraction_method | VARCHAR(50) | NULL | 提取方法(TF-IDF/TextRank/BERT等) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_material_id` ON (material_id)
- `idx_keyword` ON (keyword)

---

### 7.2 `classification_logs` - 分类日志表
记录自动分类的过程和结果。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 日志ID |
| material_id | INT | NOT NULL | 资料ID **[FK→materials.id]** |
| original_category_id | INT | NULL | 原分类ID **[FK→material_categories.id]** |
| suggested_category_id | INT | NOT NULL | 建议分类ID **[FK→material_categories.id]** |
| confidence | DECIMAL(5,4) | NULL | 置信度(0-1) |
| is_accepted | TINYINT | NULL | 是否接受建议(1:是, 0:否, NULL:待处理) |
| algorithm_used | VARCHAR(50) | NULL | 使用的算法(NaiveBayes/SVM/BERT等) |
| features | JSON/TEXT | NULL | 特征数据(JSON格式) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_material_id` ON (material_id)
- `idx_is_accepted` ON (is_accepted)

---

## 8. 系统日志与通知

### 8.1 `system_logs` - 系统日志表
记录用户操作和系统事件。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 日志ID |
| user_id | INT | NULL | 用户ID **[FK→users.id]** |
| action | VARCHAR(50) | NOT NULL | 操作类型(login/upload/delete等) |
| module | VARCHAR(50) | NOT NULL | 模块名称(user/material/grade等) |
| ip_address | VARCHAR(50) | NULL | IP地址 |
| user_agent | VARCHAR(255) | NULL | 用户代理 |
| request_data | JSON/TEXT | NULL | 请求数据(JSON格式) |
| response_status | INT | NULL | 响应状态码 |
| error_message | TEXT | NULL | 错误信息 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_user_id` ON (user_id)
- `idx_action` ON (action)
- `idx_create_time` ON (create_time)

---

### 8.2 `notifications` - 通知表
系统通知和消息推送。

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INT/BIGINT | PRIMARY KEY, AUTO_INCREMENT | 通知ID |
| user_id | INT | NOT NULL | 接收者ID **[FK→users.id]** |
| type | VARCHAR(20) | NOT NULL | 通知类型(system/attendance/grade/warning) |
| title | VARCHAR(100) | NOT NULL | 通知标题 |
| content | TEXT | NOT NULL | 通知内容 |
| link | VARCHAR(255) | NULL | 跳转链接 |
| is_read | TINYINT | DEFAULT 0 | 是否已读(1:是, 0:否) |
| priority | TINYINT | DEFAULT 0 | 优先级(0:普通, 1:重要, 2:紧急) |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引:**
- `idx_user_id` ON (user_id)
- `idx_is_read` ON (is_read)
- `idx_type` ON (type)
- `idx_create_time` ON (create_time)

---

## 9. 数据库设计说明

### 9.1 数据库选择建议

**推荐使用 MySQL 8.0+ 或 PostgreSQL 13+**

| 数据库 | 优势 | 适用场景 |
|--------|------|----------|
| **MySQL** | 成熟稳定、社区支持好、性能优秀 | 中小型应用、快速开发 |
| **PostgreSQL** | 功能强大、支持JSON、复杂查询优秀 | 需要复杂查询和数据分析 |
| **SQLite** | 轻量级、零配置、适合原型开发 | 开发测试阶段 |

### 9.2 字段类型说明

- **主键**: 使用 `INT` 或 `BIGINT`，根据数据量选择
- **时间戳**: 统一使用 `DATETIME`，支持时区转换
- **JSON字段**: MySQL 5.7+/PostgreSQL 支持原生JSON类型
- **文本字段**: 
  - 短文本: `VARCHAR(n)`
  - 长文本: `TEXT`
  - 超长文本: `LONGTEXT`

### 9.3 索引策略

1. **主键索引**: 所有表自动创建
2. **外键索引**: 所有外键字段建立索引
3. **唯一索引**: username, email, course_code等
4. **普通索引**: 频繁查询的字段
5. **复合索引**: 多字段联合查询
6. **全文索引**: 支持全文搜索的字段

### 9.4 数据完整性

1. **外键约束**: 确保引用完整性
2. **唯一约束**: 防止重复数据
3. **非空约束**: 必填字段
4. **检查约束**: 数据范围验证
5. **默认值**: 合理的默认值设置

### 9.5 性能优化建议

1. **分区表**: 对大数据量表(如logs)按时间分区
2. **读写分离**: 主从复制，读写分离
3. **缓存策略**: Redis缓存热点数据
4. **定期归档**: 历史数据归档处理
5. **慢查询优化**: 监控并优化慢查询

---

## 10. 数据库关系图

### 核心关系说明

```
users (用户表)
  ├── N:1 → classes (班级表 - 学生)
  ├── 1:N → classes (班级表 - 班主任)
  ├── 1:N → materials (资料表)
  ├── 1:N → courses (课程表 - 教师)
  ├── 1:N → attendances (考勤任务表)
  ├── 1:N → attendance_records (考勤记录表)
  ├── 1:N → grades (成绩表)
  └── 1:N → notifications (通知表)

classes (班级表)
  ├── 1:N → users (用户表 - 学生)
  ├── N:1 → users (用户表 - 班主任)
  └── N:M → courses (课程表) via course_classes

courses (课程表)
  ├── 1:N → materials (资料表)
  ├── 1:N → attendances (考勤任务表)
  ├── 1:N → grades (成绩表)
  ├── 1:N → polls (投票表)
  ├── N:M → classes (班级表) via course_classes
  └── N:M → users (用户表 - 学生) via course_students

materials (资料表)
  ├── N:1 → courses (课程表)
  ├── N:1 → material_categories (分类表)
  ├── N:M → material_tags (标签表) via material_tag_relation
  └── 1:N → document_keywords (关键词表)
```

---

## 11. 初始化数据建议

### 11.1 默认分类
```sql
INSERT INTO material_categories (name, description) VALUES
('课件', '教学课件资料'),
('作业', '课后作业资料'),
('试卷', '考试试卷资料'),
('参考资料', '课程参考资料'),
('其他', '其他类型资料');
```

---

## 12. 后续开发建议

### 12.1 Flask-SQLAlchemy模型
- 基于此表结构创建ORM模型
- 定义模型关系(relationship)
- 实现模型方法(to_dict, from_dict等)

### 12.2 数据库迁移
- 使用Flask-Migrate管理数据库版本
- 创建初始迁移脚本
- 支持数据库升级/回滚

### 12.3 API接口设计
- RESTful API规范
- 统一响应格式
- 错误处理机制
- API文档生成(Swagger/OpenAPI)

### 12.4 数据安全
- 密码加密存储(bcrypt)
- SQL注入防护
- XSS防护
- CSRF防护

---

## 附录：表统计

| 模块 | 表数量 | 说明 |
|------|--------|------|
| 用户与权限 | 1 | users |
| 资料中心 | 4 | materials, material_categories, material_tags, material_tag_relation |
| 课程 | 4 | classes, courses, course_classes, course_students |
| 考勤管理 | 3 | attendances, attendance_records, attendance_statistics |
| 成绩管理 | 3 | grades, grade_statistics, grade_predictions |
| 课堂互动 | 5 | polls, poll_responses, questions, question_answers, barrages |
| 智能模块 | 2 | document_keywords, classification_logs |
| 系统日志 | 2 | system_logs, notifications |
| **总计** | **24** | 完整覆盖所有功能需求 |

---

**文档版本**: v1.0  
**创建日期**: 2025-12-03  
**维护者**: 开发团队  
**更新记录**: 初始版本
